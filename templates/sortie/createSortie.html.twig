{% extends 'base.html.twig' %}

{% block title %} Creation de sorties | {{ parent() }}{% endblock %}
{% block stylesheets %}
    <style>
        .form-field {
            box-sizing: border-box;
            width: 60%;
        }
    </style>
{% endblock %}

{% block body %}
 {# {{form_start(form)}}
 {{form(form)}}
 {{form_end(form)}} #}
 <div class="mt-5 container flex justify-center">

        {{ form_errors(form) }}
        <form action="#" method="post">
            {{ form_start(form) }}
            <div class="space-y-12">
                <div class="border-b border-gray-900/10 pb-6">
                    <h1 class="text-base font-semibold leading-7 text-gray-900">Créer une sortie</h1>
                </div>
                <div class="border-b border-gray-900/10 pb-6">
                    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-1 sm:grid-cols-6">
                        <div class="sm:col-span-3">
                            <label for="{{ form.nom.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Nom de la sortie : </label>
                            <div class="mt-2">
                                {{ form_row(form.nom, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.siteOrganisateur.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Campus : </label>
                            <div class="mt-2">
                                {{ form_row(form.siteOrganisateur, {'attr': {'class': ' form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.dateHeureDebut.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Heure de début : </label>
                            <div class="mt-2 flex items-center">
                            <div class="relative" style="background-color:pink;">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                                        </svg>
                                    </div>
                                {{ form_row(form.dateHeureDebut, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                                </div>
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                             <label for="{{ form.ville.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Ville : </label>
                            <div class="mt-2">
                                {{ form_row(form.ville, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div> 
                        <div class="sm:col-span-3">
                            <label for="{{ form.dateLimiteInscription.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Date limite d'inscription
                                :</label>
                            <div class="mt-2 flex items-center">
                            <div class="relative" style="background-color:pink;">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                                        </svg>
                                    </div>
                                {{ form_row(form.dateLimiteInscription, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                                </div>
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="{{ form.lieu.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Lieu : </label>
                            <div class="mt-2 flex">
                                {{ form_row(form.lieu, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                                <img class="h-8 w-auto" src="{{ asset('img/plus.svg') }}" alt="Plus">
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="{{ form.nbInscriptionsMax.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Nombre de places : </label>
                            <div class="mt-2">
                                {{ form_row(form.nbInscriptionsMax, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.rue.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Rue : </label>
                            <div class="mt-2">
                                {{ form_row(form.rue, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.duree.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Durée : </label>
                            <div class="mt-2">
                                {{ form_row(form.duree, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.codePostal.vars.id }}codePostal"
                                   class="block text-sm font-medium leading-6 text-gray-900">Code postal : </label>
                            <div class="mt-2">
                                {{ form_row(form.codePostal, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.infosSortie.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Descritpion et infos : </label>
                            <div class="mt-2">
                                {{ form_row(form.infosSortie, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                        <div>
                        <div class="sm:col-span-3">
                            <label for="{{ form.latitude.vars.id }}"
                                   class="block text-sm font-medium leading-6 text-gray-900">Latitude : </label>
                            <div class="mt-2">
                                {{ form_row(form.latitude, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                            </div>
                        </div>
                            <div class="sm:col-span-3">
                                <label for="{{ form.longitude.vars.id }}"
                                       class="block text-sm font-medium leading-6 text-gray-900">Longitude : </label>
                                <div class="mt-2">
                                    {{ form_row(form.longitude, {'attr': {'class': 'form-field px-2 py-1 border rounded focus:outline-none focus:border-blue-500'}, 'label': false}) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="mt-3 flex items-center justify-end gap-x-6">
                <button type="reset" class="text-sm font-semibold leading-6 text-gray-900">Annuler</button>
                {{ form_widget(form.post, {'attr': {'class': 'rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600'}}) }}
                {{ form_widget(form.save, {'attr': {'class': 'rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600'}}) }}
            </div>


            {{ form_end(form) }}


        </form>


    </div>




    <script>
    const lieuSelect = document.querySelector('#sortie_lieu');
   const lieuList = document.querySelector('#sortie_lieu');
    const latitudeInput = document.querySelector('#sortie_latitude');
const longitudeInput = document.querySelector('#sortie_longitude');
const villeSelect = document.querySelector('#sortie_ville');
 const rueInput = document.querySelector('#sortie_rue');
    const codePostalInput = document.querySelector('#sortie_codePostal');

    villeSelect.addEventListener('change', (event) => {
    const selectedOption = event.target.selectedOptions[0];
    const villeId = selectedOption.value;
    fetch(`/get-cp-by-ville/${villeId}`)
        .then(response => response.json())
        .then(data => {
            console.log("Données reçues du serveur (ville):", data);
            codePostalInput.value = data.codePostal || '';
            lieuList.innerHTML = ''; // Supprimer les options actuelles
            rueInput.value = ''; // Réinitialiser le nom de la rue
            lieu.forEach(lieu => {
                        const option = document.createElement('option');
                        option.value = lieu.id;
                        option.textContent = lieu.nom;
                        lieuList.appendChild(option);
                    });
            // Mettre à jour la liste des lieux en fonction de la ville
        
                    // Mettre à jour les coordonnées en fonction du lieu sélectionné
                    updateLieuFields();
                
        })
        .catch(error => console.error('Error fetching ville:', error));
});

lieuSelect.addEventListener('change', updateLieuFields);

function updateLieuFields() {
    const selectedLieuOption = lieuList.selectedOptions[0];
    if (selectedLieuOption) {
        const lieuId = selectedLieuOption.value;
        fetch(`/get-rue-by-lieu/${lieuId}`)
            .then(response => response.json())
            .then(data => {
                console.log("Données reçues du serveur (lieu):", data);
                rueInput.value = data.rue || '';
                latitudeInput.value = data.latitude || '';
                longitudeInput.value = data.longitude || '';
            })
            .catch(error => console.error('Error fetching lieu:', error));
    } else {
        // Réinitialiser les champs du lieu si aucun lieu n'est sélectionné
        rueInput.value = '';
        latitudeInput.value = '';
        longitudeInput.value = '';
    }
}
</script>

{% endblock %}
 


